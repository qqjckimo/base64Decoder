const translations={"zh-TW":{mainTitle:"🖼️ Base64 圖片解碼與像素分析工具",subtitle:"貼上 Base64 編碼的圖片字串，即可查看圖片並分析像素內容",inputSectionTitle:"📝 輸入 Base64 字串",inputPlaceholder:"貼上您的 Base64 字串，例如：\ndata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...\n或直接貼上 base64 編碼部分",decodeButton:"🔍 解碼並分析",clearButton:"🗑️ 清空",exampleButton:"📋 載入範例",imageDisplayTitle:"🖼️ 圖片顯示",waitingText:"等待圖片載入...",pixelAnalysisTitle:"📊 像素分析",dimensionLabel:"尺寸：",formatLabel:"格式：",fileSizeLabel:"檔案大小：",totalPixelsLabel:"總像素數：",uniqueColorsLabel:"獨特顏色數",avgBrightnessLabel:"平均亮度",transparentPixelsLabel:"透明像素",dominantColorsTitle:"主要顏色",clickPixelTitle:"點擊圖片查看像素資訊",coordsLabel:"座標：",rgbLabel:"RGB：",hexLabel:"HEX：",hslLabel:"HSL：",pleaseInputBase64:"請輸入 Base64 字串",decodeSuccess:"圖片解碼成功！",decodeError:"無法解碼圖片，請確認 Base64 字串是否正確",loadFailed:"圖片載入失敗",aboutSize:"約"},en:{mainTitle:"🖼️ Base64 Image Decoder and Pixel Analysis Tool",subtitle:"Paste your Base64 encoded image string to view the image and analyze pixel content",inputSectionTitle:"📝 Input Base64 String",inputPlaceholder:"Paste your Base64 string, for example:\ndata:image/png;base64,iVBORw0KGgoAAAANSUhEUgAA...\nor paste the base64 encoded part directly",decodeButton:"🔍 Decode & Analyze",clearButton:"🗑️ Clear",exampleButton:"📋 Load Example",imageDisplayTitle:"🖼️ Image Display",waitingText:"Waiting for image to load...",pixelAnalysisTitle:"📊 Pixel Analysis",dimensionLabel:"Dimensions:",formatLabel:"Format:",fileSizeLabel:"File Size:",totalPixelsLabel:"Total Pixels:",uniqueColorsLabel:"Unique Colors",avgBrightnessLabel:"Avg Brightness",transparentPixelsLabel:"Transparent Pixels",dominantColorsTitle:"Dominant Colors",clickPixelTitle:"Click on image to view pixel information",coordsLabel:"Coordinates:",rgbLabel:"RGB:",hexLabel:"HEX:",hslLabel:"HSL:",pleaseInputBase64:"Please enter Base64 string",decodeSuccess:"Image decoded successfully!",decodeError:"Unable to decode image, please check if the Base64 string is correct",loadFailed:"Image loading failed",aboutSize:"About"}};let currentLanguage="zh-TW";function detectLanguage(){const e=localStorage.getItem("base64decoder-language");if(e&&translations[e])return e;return(navigator.language||navigator.userLanguage).startsWith("zh")?"zh-TW":"en"}function toggleLanguage(){currentLanguage="zh-TW"===currentLanguage?"en":"zh-TW",localStorage.setItem("base64decoder-language",currentLanguage),applyLanguage()}function applyLanguage(){const e=translations[currentLanguage];document.getElementById("languageToggle").innerHTML="zh-TW"===currentLanguage?"🌐 EN":"🌐 中文",document.getElementById("mainTitle").textContent=e.mainTitle,document.getElementById("subtitle").textContent=e.subtitle,document.getElementById("inputSectionTitle").textContent=e.inputSectionTitle,document.getElementById("base64Input").placeholder=e.inputPlaceholder,document.getElementById("decodeButton").innerHTML=e.decodeButton,document.getElementById("clearButton").innerHTML=e.clearButton,document.getElementById("exampleButton").innerHTML=e.exampleButton,document.getElementById("imageDisplayTitle").textContent=e.imageDisplayTitle,document.getElementById("pixelAnalysisTitle").textContent=e.pixelAnalysisTitle,document.getElementById("dimensionLabel").textContent=e.dimensionLabel,document.getElementById("formatLabel").textContent=e.formatLabel,document.getElementById("fileSizeLabel").textContent=e.fileSizeLabel,document.getElementById("totalPixelsLabel").textContent=e.totalPixelsLabel,document.getElementById("uniqueColorsLabel").textContent=e.uniqueColorsLabel,document.getElementById("avgBrightnessLabel").textContent=e.avgBrightnessLabel,document.getElementById("transparentPixelsLabel").textContent=e.transparentPixelsLabel,document.getElementById("dominantColorsTitle").textContent=e.dominantColorsTitle,document.getElementById("clickPixelTitle").textContent=e.clickPixelTitle,document.getElementById("coordsLabel").textContent=e.coordsLabel,document.getElementById("rgbLabel").textContent=e.rgbLabel,document.getElementById("hexLabel").textContent=e.hexLabel,document.getElementById("hslLabel").textContent=e.hslLabel;const t=document.getElementById("imageContainer");t.querySelector(".placeholder")&&(t.innerHTML=`<div class="placeholder">${e.waitingText}</div>`),document.title=e.mainTitle,document.documentElement.lang="zh-TW"===currentLanguage?"zh-TW":"en"}document.addEventListener("DOMContentLoaded",function(){currentLanguage=detectLanguage(),applyLanguage()});let currentCanvas=null,currentContext=null;function showAlert(e,t="error"){const n=document.getElementById("alertMessage");n.className="alert "+t,n.textContent=e,n.style.display="block",setTimeout(()=>{n.style.display="none"},5e3)}function decodeImage(){const e=document.getElementById("base64Input").value.trim(),t=translations[currentLanguage];if(!e)return void showAlert(t.pleaseInputBase64);let n=e;e.startsWith("data:image")||(n=e.startsWith("iVBORw0")?"data:image/png;base64,"+e:e.startsWith("/9j/")?"data:image/jpeg;base64,"+e:e.startsWith("R0lGOD")?"data:image/gif;base64,"+e:"data:image/png;base64,"+e);const a=new Image;a.onload=function(){displayImage(a,n),analyzePixels(a),showAlert(t.decodeSuccess,"success")},a.onerror=function(){showAlert(t.decodeError),document.getElementById("imageContainer").innerHTML=`<div class="placeholder">${t.loadFailed}</div>`},a.src=n}function displayImage(e,t){const n=document.getElementById("imageContainer"),a=document.createElement("canvas");a.width=e.width,a.height=e.height;const o=a.getContext("2d");o.drawImage(e,0,0),currentCanvas=a,currentContext=o,n.innerHTML="",n.appendChild(a),a.addEventListener("click",function(e){const t=a.getBoundingClientRect(),n=a.width/t.width,o=a.height/t.height;showPixelInfo(Math.floor((e.clientX-t.left)*n),Math.floor((e.clientY-t.top)*o))}),document.getElementById("imageInfo").style.display="block",document.getElementById("imageDimensions").textContent=`${e.width} × ${e.height} px`;let l="Unknown";t.includes("image/png")?l="PNG":t.includes("image/jpeg")||t.includes("image/jpg")?l="JPEG":t.includes("image/gif")?l="GIF":t.includes("image/webp")&&(l="WebP"),document.getElementById("imageFormat").textContent=l;const i=t.split(",")[1]?.length||t.length,d=Math.round(.75*i/1024),s=translations[currentLanguage];document.getElementById("fileSize").textContent=`${s.aboutSize} ${d} KB`,document.getElementById("totalPixels").textContent=(e.width*e.height).toLocaleString(),document.body.style.background=`\n                linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 100%),\n                url('${t}')\n            `,document.body.style.backgroundSize="cover",document.body.style.backgroundPosition="center",document.body.style.backgroundAttachment="fixed"}function analyzePixels(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0);const a=n.getImageData(0,0,t.width,t.height).data,o=new Map;let l=0,i=0;for(let e=0;e<a.length;e+=4){const t=a[e],n=a[e+1],d=a[e+2],s=a[e+3];s<255&&l++;i+=(299*t+587*n+114*d)/1e3;const r=`${t},${n},${d},${s}`;o.set(r,(o.get(r)||0)+1)}const d=a.length/4,s=Math.round(i/d/255*100);document.getElementById("pixelAnalysis").style.display="block",document.getElementById("uniqueColors").textContent=o.size.toLocaleString(),document.getElementById("avgBrightness").textContent=s+"%",document.getElementById("transparentPixels").textContent=l.toLocaleString();const r=Array.from(o.entries()).sort((e,t)=>t[1]-e[1]).slice(0,5),c=document.getElementById("dominantColors");c.innerHTML="",r.forEach(([e,t])=>{const[n,a,o,l]=e.split(",").map(Number),i=(t/d*100).toFixed(2),s=document.createElement("div");s.style.cssText="\n                    display: flex;\n                    align-items: center;\n                    margin-bottom: 10px;\n                ";const r=document.createElement("div");r.style.cssText=`\n                    width: 40px;\n                    height: 40px;\n                    background: rgba(${n}, ${a}, ${o}, ${l/255});\n                    border: 1px solid #ddd;\n                    border-radius: 5px;\n                    margin-right: 15px;\n                `;const g=document.createElement("div");g.innerHTML=`\n                    <div style="font-weight: 600;">${rgbToHex(n,a,o)}</div>\n                    <div style="color: #666; font-size: 0.9em;">RGB(${n}, ${a}, ${o}) - ${i}%</div>\n                `,s.appendChild(r),s.appendChild(g),c.appendChild(s)})}function showPixelInfo(e,t){if(!currentContext)return;const n=currentContext.getImageData(e,t,1,1).data,a=n[0],o=n[1],l=n[2],i=n[3];document.getElementById("clickedPixelInfo").style.display="block",document.getElementById("clickedColorPreview").style.background=`rgba(${a}, ${o}, ${l}, ${i/255})`,document.getElementById("pixelCoords").textContent=`(${e}, ${t})`,document.getElementById("pixelRGB").textContent=`rgb(${a}, ${o}, ${l})`,document.getElementById("pixelHEX").textContent=rgbToHex(a,o,l);const d=rgbToHsl(a,o,l);document.getElementById("pixelHSL").textContent=`hsl(${d.h}°, ${d.s}%, ${d.l}%)`}function rgbToHex(e,t,n){return"#"+[e,t,n].map(e=>{const t=e.toString(16);return 1===t.length?"0"+t:t}).join("").toUpperCase()}function rgbToHsl(e,t,n){e/=255,t/=255,n/=255;const a=Math.max(e,t,n),o=Math.min(e,t,n);let l,i,d=(a+o)/2;if(a===o)l=i=0;else{const s=a-o;switch(i=d>.5?s/(2-a-o):s/(a+o),a){case e:l=((t-n)/s+(t<n?6:0))/6;break;case t:l=((n-e)/s+2)/6;break;case n:l=((e-t)/s+4)/6}}return{h:Math.round(360*l),s:Math.round(100*i),l:Math.round(100*d)}}function clearAll(){document.getElementById("base64Input").value="";const e=translations[currentLanguage];document.getElementById("imageContainer").innerHTML=`<div class="placeholder">${e.waitingText}</div>`,document.getElementById("imageInfo").style.display="none",document.getElementById("pixelAnalysis").style.display="none",document.getElementById("alertMessage").style.display="none",currentCanvas=null,currentContext=null,document.body.style.background="\n                linear-gradient(135deg, rgba(102, 126, 234, 0.8) 0%, rgba(118, 75, 162, 0.8) 100%),\n                #e5e5e5\n            ",document.body.style.backgroundSize="cover",document.body.style.backgroundPosition="center",document.body.style.backgroundAttachment="fixed"}function loadExample(){document.getElementById("base64Input").value="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8DwHwAFBQIAX8jx0gAAAABJRU5ErkJggg==",decodeImage()}const textarea=document.getElementById("base64Input");textarea.addEventListener("dragover",e=>{e.preventDefault(),textarea.style.borderColor="#667eea"}),textarea.addEventListener("dragleave",e=>{e.preventDefault(),textarea.style.borderColor="#e0e0e0"}),textarea.addEventListener("drop",e=>{e.preventDefault(),textarea.style.borderColor="#e0e0e0";const t=e.dataTransfer.files[0];if(t&&t.type.startsWith("image/")){const e=new FileReader;e.onload=e=>{textarea.value=e.target.result,decodeImage()},e.readAsDataURL(t)}}),document.addEventListener("paste",e=>{const t=e.clipboardData.items;for(let e of t)if(-1!==e.type.indexOf("image")){const t=e.getAsFile(),n=new FileReader;n.onload=e=>{document.getElementById("base64Input").value=e.target.result,decodeImage()},n.readAsDataURL(t)}});